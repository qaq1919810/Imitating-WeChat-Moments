<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            font-family: 黑体;
            line-height: 1;
            border: 0;
            padding: 0;
            margin: 0;
            flex-wrap: wrap;
            box-sizing: border-box;
            background-repeat: no-repeat;
            background-size: cover;
        }

        /*更多*/
        .more {
            display: flex;
            justify-content: space-between;
        }


    </style>
    <script>
        // 点赞评论冒泡处理
        let popStatus = false
        function popMore(e) {
            // noinspection CssInvalidPropertyValue
            const popButton = `
                <div style="position: absolute; width: ${0.48 * mw}px; height: ${0.1 * mw}px; background-color: #4c4c4c; left: -13%; transform: translateX(-100%); border-radius: ${0.008 * mw}px; display: flex; align-items: center;">
                    <div style="width: 100%; height: 60%; display: flex; font-size: ${0.032 * mw}px; color: white;">
                        <div style="width: 50%;height: 100%;border-right: 0.5px solid #858585;display: flex; align-items: center;justify-content: center;">赞</div>
                        <div style="width: 50%;height: 100%;border-left: 0.5px solid #858585;display: flex; align-items: center;justify-content: center;">评论</div>
                    </div>
                </div>
            `
            const popButtonBack = `
                <div></div><div></div><div></div><div></div><div></div>
            `
            // 清除上次监听
            document.removeEventListener("click", clc)
            document.removeEventListener("scroll", scr)
            if (popStatus) {
                popStatus = false
                e.innerHTML = popButtonBack
            } else {
                popStatus = true
                e.innerHTML += popButton
                // 等待当前点击完成后再监听外部点击（否则点自己也被当成外部）
                setTimeout(() => {
                    document.addEventListener("click", clc)
                }, 0)
                document.addEventListener("scroll", scr)
            }

            function clc() {
                popStatus = false
                e.innerHTML = popButtonBack
                document.removeEventListener("click", clc)
                document.removeEventListener("scroll", scr)
            }

            function scr() {
                popStatus = false
                e.innerHTML = popButtonBack
                document.removeEventListener("click", clc)
                document.removeEventListener("scroll", scr)
            }
        }

    </script>
</head>
<body style="background-color: #402b0c">
<div class="main" id="main">
    <script>
        // 定义大盒子长宽
        let mainDiv = document.getElementById('main')
        if (innerWidth > innerHeight) {
            // alert('目前对于桌面端支持度较差建议移动设备使用\n如需桌面端使用建议把浏览器窗口大小调成手机比例然后刷新此页面')
            mainDiv.style.width = `${innerWidth * 0.45}px`
        } else {
            mainDiv.style.width = `${innerWidth}px`
        }
        let mw = parseFloat(mainDiv.style.width)

        // 定义各个元素的样式
        let style = document.createElement('style')
        style.textContent = `
            /*整个大盒子*/
            .main {
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                background-color: white;
            }

            /*小盒子*/
            .basicBlock {
                width: 100%;
                display: flex;
                border-width: 0.5px 0 0.5px 0;
                border-style: solid;
                border-color: #e3e3e3;
                padding: ${0.03 * mw}px ${0.036 * mw}px ${0.04 * mw}px ${0.05 * mw}px;
            }

            /*左半边*/
            .leftContent {
                width: ${0.1 * mw}px;
                height: 100%;
            }

            /*头像*/
            .avatar {
                display: inline-block;
                height: ${0.1 * mw}px;
                width: ${0.1 * mw}px;
                border-radius: ${0.01 * mw}px;
                background-color: skyblue;
            }

            /*右半边*/
            .rightContent {
                width: ${0.784 * mw}px;
                margin-left: ${0.03 * mw}px;
                height: 100%;
            }

            /*用户名*/
            .userName {
                color: #5b6d95;
                font-size: ${0.04 * mw}px;
                margin-top: ${0.0093 * mw}px;
            }

            /*用户信息*/
            .userMessage {
                margin-top: ${0.025 * mw}px;
                color: #1a1a1a;
                font-size: ${0.04 * mw}px;
            }

            /*发送时间*/
            .sendTime {
                font-size: ${0.03 * mw}px;
                margin-top: ${0.03 * mw}px;
                color: #b1b1b3;
            }
            /*用户点赞和评论按钮*/
            .userLikeAndCommentButton{
                position: relative;
                margin-top: ${0.03 * mw}px;
                width: ${0.08 * mw}px;
                height: ${0.05 * mw}px;
                background-color: #f7f8fa;
                border-radius: ${0.005 * mw}px;
                display: flex;
                justify-content: space-around;
                align-items: center;
                border-radius: ${0.008 * mw}px;
            }
            .userLikeAndCommentButton>:nth-child(2),
            .userLikeAndCommentButton>:nth-child(4){
                aspect-ratio: 1 / 1;
                background-color: #606688;
                border-radius: ${mw}px;
            }
            .userLikeAndCommentButton > :nth-child(-n+6){
                width: 20%;
                aspect-ratio: 1 / 1;
            }
        `
        document.head.appendChild(style)
    </script>

    <script>
        document.addEventListener("DOMContentLoaded",async () => {
            const avatarData = "./media/avatar/"
            let data
            await fetch("./data/default.json").then(res => res.json()).then(res => data = res)

            data.forEach((item) => {
                // noinspection CssInvalidPropertyValue
                document.getElementById('main').innerHTML += `
                    <div class="basicBlock">
                        <div class="leftContent">
                            <div class="avatar" style="background-image: url('${avatarData+item.userAvatar}')"></div>
                        </div>
                        <div class="rightContent">
                            <!--用户名-->
                            <p class="userName">${item.userName}</p>
                            <!--用户发布的消息-->
                            <p class="userMessage">${item.userMessage}</p>
                            <div class="more">
                                <!--发布时间-->
                                <p class="sendTime">${item.sendTime}</p>
                                <!--用户评论和点赞按钮-->
                                <div class="userLikeAndCommentButton" onclick="popMore(this)">
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            })
        })
    </script>
</div>
</body>
</html>